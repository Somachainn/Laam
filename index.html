<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Laam DEX</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/stellar-sdk/10.5.0/stellar-sdk.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.2/axios.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f6fa;
      color: #222;
    }
    header {
      background: #004aad;
      color: #fff;
      padding: 20px;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
    }
    .container {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 20px;
      padding: 20px;
    }
    .card {
      background: #fff;
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .portfolio {
      text-align: center;
    }
    .buttons {
      display: flex;
      justify-content: space-around;
      margin: 15px 0;
    }
    .buttons button {
      padding: 10px 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background: #004aad;
      color: #fff;
      font-weight: bold;
    }
    h2 {
      text-align: center;
      color: #004aad;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    table th, table td {
      border: 1px solid #ddd;
      padding: 8px;
      font-size: 14px;
      text-align: center;
    }
    table th {
      background: #f0f0f0;
    }
    .trade-section {
      display: flex;
      justify-content: space-between;
      gap: 15px;
    }
    .trade-box {
      flex: 1;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 15px;
      background: #fff;
    }
    .trade-box h3 {
      text-align: center;
      margin-bottom: 10px;
      color: #004aad;
    }
    .trade-box input {
      width: 90%;
      padding: 8px;
      margin: 5px auto;
      display: block;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .trade-box button {
      display: block;
      margin: 10px auto;
      padding: 8px 15px;
      background: #004aad;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>Laam DEX</header>

  <div class="container">
    <!-- Wallet Section -->
    <div>
      <div class="card portfolio">
        <h2>Portfolio</h2>
        <p id="balanceXLM">XLM: --</p>
        <p id="balanceLaam">Laam: --</p>
      </div>

      <div class="card buttons">
        <button onclick="sendAsset()">Send</button>
        <button onclick="receiveAsset()">Receive</button>
        <button onclick="addTrustline()">Add Laam</button>
        <button onclick="lockWallet()">Lock</button>
      </div>

      <div class="card">
        <h2>My Assets</h2>
        <p id="myAssets">Loading...</p>
      </div>
    </div>

    <!-- Trade Section -->
    <div>
      <div class="card">
        <h2>Trade Laam/XLM</h2>
        <p id="priceUpdate">Live Price: --</p>
        
        <div class="trade-section">
          <!-- Buy Box -->
          <div class="trade-box">
            <h3>Buy Laam</h3>
            <input type="number" id="buyAmount" placeholder="Amount (Laam)">
            <input type="number" id="buyPrice" placeholder="Price (XLM)">
            <button onclick="placeBuy()">Buy</button>
          </div>
          <!-- Sell Box -->
          <div class="trade-box">
            <h3>Sell Laam</h3>
            <input type="number" id="sellAmount" placeholder="Amount (Laam)">
            <input type="number" id="sellPrice" placeholder="Price (XLM)">
            <button onclick="placeSell()">Sell</button>
          </div>
        </div>
      </div>

      <div class="card">
        <h2>Order Book</h2>
        <table>
          <thead>
            <tr><th>Price (XLM)</th><th>Amount (Laam)</th><th>Total (XLM)</th></tr>
          </thead>
          <tbody id="orderBook"></tbody>
        </table>
      </div>

      <div class="card">
        <h2>Last Trades</h2>
        <table>
          <thead>
            <tr><th>Type</th><th>Amount</th><th>Price</th></tr>
          </thead>
          <tbody id="lastTrades"></tbody>
        </table>
      </div>
    </div>
  </div>

<script>
const server = new StellarSdk.Server("https://horizon.stellar.org");
const issuer = "GAL4ECDAXNBMJYFCWIJ32HKVIRLCNEXY664CAZYI3EINQWPLXTMEPR64";
const laamAsset = new StellarSdk.Asset("Laam", issuer);

// Balances
async function loadBalances(pubKey) {
  try {
    const account = await server.loadAccount(pubKey);
    let xlm = 0, laam = 0;
    account.balances.forEach(b => {
      if (b.asset_type === "native") xlm = b.balance;
      if (b.asset_code === "Laam") laam = b.balance;
    });
    document.getElementById("balanceXLM").innerText = "XLM: " + xlm;
    document.getElementById("balanceLaam").innerText = "Laam: " + laam;
  } catch (e) {
    console.log("Error loading balances", e);
  }
}

// Orderbook
async function loadOrderBook() {
  const ob = await server.orderbook(laamAsset, StellarSdk.Asset.native()).call();
  const tbody = document.getElementById("orderBook");
  tbody.innerHTML = "";
  ob.bids.forEach(b => {
    tbody.innerHTML += `<tr><td>${b.price}</td><td>${b.amount}</td><td>${(b.price * b.amount).toFixed(2)}</td></tr>`;
  });
  ob.asks.forEach(a => {
    tbody.innerHTML += `<tr><td>${a.price}</td><td>${a.amount}</td><td>${(a.price * a.amount).toFixed(2)}</td></tr>`;
  });
  if (ob.asks.length > 0) {
    document.getElementById("priceUpdate").innerText = "Live Price: " + ob.asks[0].price + " XLM/Laam";
  }
}

// Last Trades
async function loadTrades() {
  const trades = await server.trades().forAssetPair(laamAsset, StellarSdk.Asset.native()).limit(5).call();
  const tbody = document.getElementById("lastTrades");
  tbody.innerHTML = "";
  trades.records.forEach(t => {
    tbody.innerHTML += `<tr><td>${t.base_is_seller ? "Sell" : "Buy"}</td><td>${t.base_amount}</td><td>${t.price.n/t.price.d}</td></tr>`;
  });
}

// Dummy Functions
function sendAsset(){ alert("Send clicked"); }
function receiveAsset(){ alert("Receive clicked"); }
function addTrustline(){ alert("Trustline added"); }
function lockWallet(){ alert("Wallet locked"); }
function placeBuy(){ alert("Buy order placed"); }
function placeSell(){ alert("Sell order placed"); }

// Auto refresh
setInterval(() => {
  loadOrderBook();
  loadTrades();
}, 5000);

// Example test key
const testPubKey = "G...YOUR_PUBLIC_KEY";
loadBalances(testPubKey);
</script>
</body>
</html>
